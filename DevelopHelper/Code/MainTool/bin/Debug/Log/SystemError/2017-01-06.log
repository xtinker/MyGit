2017-01-06 16:58:44,179 [T:1] [L:ERROR] [C:LogWriter.Error] [P:d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\Common\LogWriter.cs-36] - USE master

--关闭数据库的引用
IF EXISTS ( SELECT  name
            FROM    master.dbo.sysdatabases
            WHERE   name = N'dotnet_erp352SP1' )
    ALTER DATABASE [dotnet_erp352SP1] SET OFFLINE WITH ROLLBACK IMMEDIATE;

--如果要创建的数据库已经存在，那么删除它
IF EXISTS ( SELECT  name
            FROM    master.dbo.sysdatabases
            WHERE   name = N'dotnet_erp352SP1' )
    DROP DATABASE [dotnet_erp352SP1]

--创建一个新数据库，要指定新建数据库的数据文件和日志文件的名称和位置，初始化大小增长幅度，最大值等内容

CREATE DATABASE [dotnet_erp352SP1] ON 

( NAME = N'dotnet_erp352SP1_Data',

   FILENAME = N'C:\database\352SP1Test\dotnet_erp352SP1_Data.mdf',

   SIZE = 5MB,

   MAXSIZE = 50MB,

   FILEGROWTH = 5MB ) LOG ON

( NAME = N'dotnet_erp352SP1_Log',

   FILENAME = N'C:\database\352SP1Test\dotnet_erp352SP1_Log.ldf',

   SIZE = 5MB,

   MAXSIZE = 25MB,

   FILEGROWTH = 5MB )

--把指定的数据库备份文件恢复到刚刚建立的数据库里，这里要指定数据库备份文件的位置

--以及要恢复到的数据库，因为备份文件来自未知的机器，备份的时候原数据库和新数据库

--的数据文件和日志文件的位置不匹配，所以要用with move指令来完成强制文件移动，如果

--是通过管理器备份的数据库文件，数据库文件和日志文件名分别是数据库名跟上_Data或

--_Log，这是一个假设哦，如果不是这样，脚本有可能会出错

RESTORE DATABASE [dotnet_erp352SP1]

   FROM DISK = '\\Wh-xiaoy03\共享文件夹\352SP1空库备份\dotnet_erp352SP1.bak'

WITH  FILE = 1,

      MOVE 'dotnet_crm50sp1' TO 'C:\database\352SP1Test\dotnet_erp352SP1.mdf', 

      MOVE 'dotnet_crm50sp1_log' TO 'C:\database\352SP1Test\dotnet_erp352SP1.ldf',

      NOUNLOAD, 

      REPLACE, 

      STATS = 10

--打开数据库的引用
ALTER DATABASE [dotnet_erp352SP1] set ONLINE;

System.Data.SqlClient.SqlException (0x80131904): 在从服务器接收结果时发生传输级错误。 (provider: TCP Provider, error: 0 - 指定的网络名不再可用。)
已将数据库上下文更改为 'master'。
已处理百分之 10。 ---> System.ComponentModel.Win32Exception (0x80004005): 指定的网络名不再可用。
   在 System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   在 System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error)
   在 System.Data.SqlClient.TdsParserStateObject.ReadSniSyncOverAsync()
   在 System.Data.SqlClient.TdsParserStateObject.TryReadNetworkPacket()
   在 System.Data.SqlClient.TdsParserStateObject.TryPrepareBuffer()
   在 System.Data.SqlClient.TdsParserStateObject.TryReadByte(Byte& value)
   在 System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   在 System.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout)
   在 System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite)
   在 System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   在 DbHelper.SqlServerHelper.ExecuteNonQuery(String cmdText) 位置 d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\DbHelper\SqlServerHelper.cs:行号 88
ClientConnectionId:20bba56c-24d2-4313-a553-63ff950d8bb9
2017-01-06 17:00:28,626 [T:1] [L:ERROR] [C:LogWriter.Error] [P:d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\Common\LogWriter.cs-36] - USE master

--关闭数据库的引用
IF EXISTS ( SELECT  name
            FROM    master.dbo.sysdatabases
            WHERE   name = N'dotnet_erp352SP1' )
    ALTER DATABASE [dotnet_erp352SP1] SET OFFLINE WITH ROLLBACK IMMEDIATE;

--如果要创建的数据库已经存在，那么删除它
IF EXISTS ( SELECT  name
            FROM    master.dbo.sysdatabases
            WHERE   name = N'dotnet_erp352SP1' )
    DROP DATABASE [dotnet_erp352SP1]

--创建一个新数据库，要指定新建数据库的数据文件和日志文件的名称和位置，初始化大小增长幅度，最大值等内容

CREATE DATABASE [dotnet_erp352SP1] ON 

( NAME = N'dotnet_erp352SP1_Data',

   FILENAME = N'C:\database\352SP1Test\dotnet_erp352SP1_Data.mdf',

   SIZE = 5MB,

   MAXSIZE = 50MB,

   FILEGROWTH = 5MB ) LOG ON

( NAME = N'dotnet_erp352SP1_Log',

   FILENAME = N'C:\database\352SP1Test\dotnet_erp352SP1_Log.ldf',

   SIZE = 5MB,

   MAXSIZE = 25MB,

   FILEGROWTH = 5MB )

--把指定的数据库备份文件恢复到刚刚建立的数据库里，这里要指定数据库备份文件的位置

--以及要恢复到的数据库，因为备份文件来自未知的机器，备份的时候原数据库和新数据库

--的数据文件和日志文件的位置不匹配，所以要用with move指令来完成强制文件移动，如果

--是通过管理器备份的数据库文件，数据库文件和日志文件名分别是数据库名跟上_Data或

--_Log，这是一个假设哦，如果不是这样，脚本有可能会出错

RESTORE DATABASE [dotnet_erp352SP1]

   FROM DISK = '\\Wh-xiaoy03\共享文件夹\352SP1空库备份\dotnet_erp352SP1.bak'

WITH  FILE = 1,

      MOVE 'dotnet_crm50sp1' TO 'C:\database\352SP1Test\dotnet_erp352SP1.mdf', 

      MOVE 'dotnet_crm50sp1_log' TO 'C:\database\352SP1Test\dotnet_erp352SP1.ldf',

      NOUNLOAD, 

      REPLACE, 

      STATS = 10

--打开数据库的引用
ALTER DATABASE [dotnet_erp352SP1] set ONLINE;

System.Data.SqlClient.SqlException (0x80131904): 当数据库处于 Restoring 状态时，不允许 ALTER DATABASE。
ALTER DATABASE 语句失败。
已将数据库上下文更改为 'master'。
已处理百分之 10。
已处理百分之 20。
已处理百分之 30。
已处理百分之 40。
已处理百分之 50。
已处理百分之 60。
已处理百分之 70。
已处理百分之 80。
已处理百分之 90。
已处理百分之 100。
已为数据库 'dotnet_erp352SP1'，文件 'dotnet_crm50sp1' (位于文件 1 上)处理了 35280 页。
已为数据库 'dotnet_erp352SP1'，文件 'dotnet_crm50sp1_log' (位于文件 1 上)处理了 4 页。
RESTORE DATABASE 成功处理了 35284 页，花费 5.958 秒(46.266 MB/秒)。
   在 System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   在 System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   在 System.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout)
   在 System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite)
   在 System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   在 DbHelper.SqlServerHelper.ExecuteNonQuery(String cmdText) 位置 d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\DbHelper\SqlServerHelper.cs:行号 88
ClientConnectionId:7ed428a2-e48f-42f3-9411-466d60fe183c
2017-01-06 17:03:56,253 [T:1] [L:ERROR] [C:LogWriter.Error] [P:d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\Common\LogWriter.cs-36] - BACKUP DATABASE [dotnet_erp352SP1] TO DISK = 'D:\MySoft\02Study\共享文件夹\352SP1开发库备份\2017-01-06\dotnet_erp352SP1.bak'
System.Data.SqlClient.SqlException (0x80131904): 无法打开备份设备 'D:\MySoft\02Study\共享文件夹\352SP1开发库备份\2017-01-06\dotnet_erp352SP1.bak'。出现操作系统错误 3(系统找不到指定的路径。)。
BACKUP DATABASE 正在异常终止。
   在 System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   在 System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   在 System.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout)
   在 System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite)
   在 System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   在 DbHelper.SqlServerHelper.ExecuteNonQuery(String cmdText) 位置 d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\DbHelper\SqlServerHelper.cs:行号 88
ClientConnectionId:98c04689-402a-4a2b-9d60-e26f4f41e75b
2017-01-06 17:04:32,791 [T:1] [L:ERROR] [C:LogWriter.Error] [P:d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\Common\LogWriter.cs-36] - BACKUP DATABASE [dotnet_erp352SP1] TO DISK = 'D:\MySoft\02Study\共享文件夹\352SP1开发库备份\2017-01-06\dotnet_erp352SP1.bak'
System.Data.SqlClient.SqlException (0x80131904): 无法打开备份设备 'D:\MySoft\02Study\共享文件夹\352SP1开发库备份\2017-01-06\dotnet_erp352SP1.bak'。出现操作系统错误 3(系统找不到指定的路径。)。
BACKUP DATABASE 正在异常终止。
   在 System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   在 System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   在 System.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout)
   在 System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite)
   在 System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   在 DbHelper.SqlServerHelper.ExecuteNonQuery(String cmdText) 位置 d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\DbHelper\SqlServerHelper.cs:行号 88
ClientConnectionId:98c04689-402a-4a2b-9d60-e26f4f41e75b
2017-01-06 17:04:55,919 [T:1] [L:ERROR] [C:LogWriter.Error] [P:d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\Common\LogWriter.cs-36] - BACKUP DATABASE [dotnet_erp352SP1] TO DISK = 'D:\MySoft\02Study\共享文件夹\352SP1开发库备份\2017-01-06\dotnet_erp352SP1.bak'
System.Data.SqlClient.SqlException (0x80131904): 无法打开备份设备 'D:\MySoft\02Study\共享文件夹\352SP1开发库备份\2017-01-06\dotnet_erp352SP1.bak'。出现操作系统错误 3(系统找不到指定的路径。)。
BACKUP DATABASE 正在异常终止。
   在 System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   在 System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   在 System.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout)
   在 System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite)
   在 System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   在 DbHelper.SqlServerHelper.ExecuteNonQuery(String cmdText) 位置 d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\DbHelper\SqlServerHelper.cs:行号 88
ClientConnectionId:98c04689-402a-4a2b-9d60-e26f4f41e75b
2017-01-06 17:05:23,907 [T:1] [L:ERROR] [C:LogWriter.Error] [P:d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\Common\LogWriter.cs-36] - BACKUP DATABASE [dotnet_erp352SP1] TO DISK = 'D:\MySoft\02Study\共享文件夹\352SP1开发库备份\2017-01-06\dotnet_erp352SP1.bak'
System.Data.SqlClient.SqlException (0x80131904): 无法打开备份设备 'D:\MySoft\02Study\共享文件夹\352SP1开发库备份\2017-01-06\dotnet_erp352SP1.bak'。出现操作系统错误 3(系统找不到指定的路径。)。
BACKUP DATABASE 正在异常终止。
   在 System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   在 System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   在 System.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout)
   在 System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite)
   在 System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   在 DbHelper.SqlServerHelper.ExecuteNonQuery(String cmdText) 位置 d:\MySoft\02Study\软件开发辅助工具\MysoftHelper\Code\Base\DbHelper\SqlServerHelper.cs:行号 88
ClientConnectionId:0736fa39-0724-4bab-91b5-391cff5c71ab
