2017-08-04 12:33:56,766 [T:4] [L:ERROR] [C:LogWriter.Error] [P:E:\MySoft\02Study\软件开发辅助工具\DevelopHelper\Code\Base\Common\LogWriter.cs-36] - USE master

--关闭数据库的引用
IF EXISTS ( SELECT  name
            FROM    master.dbo.sysdatabases
            WHERE   name = N'dotnet_erp60_hnqcd' )
    ALTER DATABASE [dotnet_erp60_hnqcd] SET OFFLINE WITH ROLLBACK IMMEDIATE;

--如果要创建的数据库已经存在，那么删除它
IF EXISTS ( SELECT  name
            FROM    master.dbo.sysdatabases
            WHERE   name = N'dotnet_erp60_hnqcd' )
    DROP DATABASE [dotnet_erp60_hnqcd]

--创建一个新数据库，要指定新建数据库的数据文件和日志文件的名称和位置，初始化大小增长幅度，最大值等内容

CREATE DATABASE [dotnet_erp60_hnqcd] ON 

( NAME = N'dotnet_erp60_hnqcd_Data',

   FILENAME = N'E:\MySoft\01Projects\Database\dotnet_erp60_hnqcd_Data.mdf',

   SIZE = 5MB,

   MAXSIZE = 50MB,

   FILEGROWTH = 5MB ) LOG ON

( NAME = N'dotnet_erp60_hnqcd_Log',

   FILENAME = N'E:\MySoft\01Projects\Database\dotnet_erp60_hnqcd_Log.ldf',

   SIZE = 5MB,

   MAXSIZE = 25MB,

   FILEGROWTH = 5MB )

--把指定的数据库备份文件恢复到刚刚建立的数据库里，这里要指定数据库备份文件的位置

--以及要恢复到的数据库，因为备份文件来自未知的机器，备份的时候原数据库和新数据库

--的数据文件和日志文件的位置不匹配，所以要用with move指令来完成强制文件移动，如果

--是通过管理器备份的数据库文件，数据库文件和日志文件名分别是数据库名跟上_Data或

--_Log，这是一个假设哦，如果不是这样，脚本有可能会出错

RESTORE DATABASE [dotnet_erp60_hnqcd]

   FROM DISK = '\\Wh-xiaoyong\共享文件夹\勤诚达\正式数据库备份\dotnet_erp60_hnqcd.bak'

WITH  FILE = 1,

      MOVE 'myscrm_defaultorganization' TO 'E:\MySoft\01Projects\Database\dotnet_erp60_hnqcd.mdf', 

      MOVE 'myscrm_defaultorganization_log' TO 'E:\MySoft\01Projects\Database\dotnet_erp60_hnqcd.ldf',

      NOUNLOAD, 

      REPLACE, 

      STATS = 10

--打开数据库的引用
ALTER DATABASE [dotnet_erp60_hnqcd] set ONLINE;

System.Data.SqlClient.SqlException (0x80131904): 对文件“E:\MySoft\01Projects\Database\dotnet_erp60_hnqcd_Data.mdf”的目录查找失败，出现操作系统错误 3(系统找不到指定的路径。)。
CREATE DATABASE 失败。无法创建列出的某些文件名。请查看相关错误。
对文件“E:\MySoft\01Projects\Database\dotnet_erp60_hnqcd.mdf”的目录查找失败，出现操作系统错误 3(系统找不到指定的路径。)。
文件 'myscrm_defaultorganization' 无法还原为 'E:\MySoft\01Projects\Database\dotnet_erp60_hnqcd.mdf'。请使用 WITH MOVE 选项来标识该文件的有效位置。
对文件“E:\MySoft\01Projects\Database\dotnet_erp60_hnqcd.ldf”的目录查找失败，出现操作系统错误 3(系统找不到指定的路径。)。
文件 'myscrm_defaultorganization_log' 无法还原为 'E:\MySoft\01Projects\Database\dotnet_erp60_hnqcd.ldf'。请使用 WITH MOVE 选项来标识该文件的有效位置。
在计划 RESTORE 语句时发现了问题。以前的消息提供了详细信息。
RESTORE DATABASE 正在异常终止。
用户没有更改数据库 'dotnet_erp60_hnqcd' 的权限，该数据库不存在，或数据库未处于允许访问检查的状态。
ALTER DATABASE 语句失败。
已将数据库上下文更改为 'master'。
   在 System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   在 System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   在 System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   在 System.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout, Boolean asyncWrite)
   在 System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry)
   在 System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   在 DbHelper.SqlServerHelper.ExecuteNonQuery(String cmdText) 位置 E:\MySoft\02Study\软件开发辅助工具\DevelopHelper\Code\Base\DbHelper\SqlServerHelper.cs:行号 88
ClientConnectionId:86e8a4e9-22eb-4216-9c7a-b654cf8827df
Error Number:5133,State:1,Class:16
